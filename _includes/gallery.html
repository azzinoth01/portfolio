<div class="gallery">
  {% for image in include.images %}
    <img src="{{ image | relative_url }}" alt="Gallery image {{ forloop.index }}">
  {% endfor %}
</div>

<div id="lightbox-{{ include.id | default: 'gallery' }}" class="lightbox">
  <span class="close">&times;</span>
  <img class="lightbox-image" src="" alt="">
  <span class="prev">&#10094;</span>
  <span class="next">&#10095;</span>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const gallery = document.querySelector(".gallery");
  const images = gallery.querySelectorAll("img");
  const lightbox = document.getElementById("lightbox-{{ include.id | default: 'gallery' }}");
  const lightboxImg = lightbox.querySelector(".lightbox-image");
  const closeBtn = lightbox.querySelector(".close");
  const prevBtn = lightbox.querySelector(".prev");
  const nextBtn = lightbox.querySelector(".next");

  let currentIndex = 0;

  function showImage(index) {
    lightboxImg.src = images[index].src;
    currentIndex = index;
    lightbox.style.display = "flex";
  }

  images.forEach((img, index) => {
    img.addEventListener("click", () => showImage(index));
  });

  closeBtn.addEventListener("click", () => lightbox.style.display = "none");

  prevBtn.addEventListener("click", () => {
    currentIndex = (currentIndex - 1 + images.length) % images.length;
    showImage(currentIndex);
  });

  nextBtn.addEventListener("click", () => {
    currentIndex = (currentIndex + 1) % images.length;
    showImage(currentIndex);
  });

  lightbox.addEventListener("click", (e) => {
    if (e.target === lightbox) {
      lightbox.style.display = "none";
    }
  });

  document.addEventListener("keydown", (e) => {
    if (lightbox.style.display === "flex") {
      if (e.key === "ArrowLeft") prevBtn.click();
      if (e.key === "ArrowRight") nextBtn.click();
      if (e.key === "Escape") closeBtn.click();
    }
  });
});
</script>
